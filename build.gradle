apply plugin: 'java'
sourceCompatibility = 11

repositories {
	jcenter()
	maven { 
		url "https://dl.bintray.com/jmonkeyengine/org.jmonkeyengine"
		url "https://dl.bintray.com/stephengold/jme3utilities" 
	}
}

sourceSets.main {
	java {
		srcDir 'src/'
		exclude '**/test/**'
	} 
	resources {
		includes = ['src/']
		excludes = ['!assets/'] //only to keep the top 'assets' folder
	}
}
sourceSets.test {
	java {
		srcDir 'src/'
		exclude '!**/test/**'
	}
}


task createFatJar(type: Jar) {
    archiveBaseName = 'rally'
	manifest {
		attributes 'Main-Class': 'game.Main'
	}

	from  {
		sourceSets.main.output + sourceSets.main.resources.includes + configurations.compileClasspath.filter{ it.exists() }.collect { it.isDirectory() ? it : zipTree(it) }
	}

	dependsOn 'build'
}

task createDuelFatJar(type: Jar) {
    archiveBaseName = 'duel'
	manifest {
		attributes 'Main-Class': 'duel.DuelApp'
	}

	from  {
		sourceSets.main.output + sourceSets.main.resources.includes + configurations.compileClasspath.filter{ it.exists() }.collect { it.isDirectory() ? it : zipTree(it) }
	}

	dependsOn 'build'
}

task cleanBlendGltfFiles(type: Delete) {
    delete fileTree('src/assets') {
        include '**/*.blend.glb'
    }
}

task convertAllBlendFiles(type: Exec) {
    workingDir 'src/assets'
    
    //sorry windows only unless you install powershell on linux
    commandLine 'cmd', '/c', 'Powershell -File blend2gltf.ps1'
}
compileJava.dependsOn(convertAllBlendFiles)

test {
    useJUnitPlatform()
}

def jme3Version = '3.2.4-stable'

dependencies {
	implementation "org.jmonkeyengine:jme3-blender:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-bullet:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-bullet-native:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-core:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-desktop:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-effects:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-lwjgl:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-plugins:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-terrain:${jme3Version}"
	implementation "org.jmonkeyengine:jme3-jogg:${jme3Version}"
	
	implementation 'org.yaml:snakeyaml:1.25'
	implementation 'com.simsilica:lemur:1.13.0'

	testImplementation 'org.junit.jupiter:junit-jupiter-api:5.5.1'
	testImplementation 'org.junit.jupiter:junit-jupiter-params:5.5.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.5.1'
}
